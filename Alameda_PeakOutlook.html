<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Peak Tide Forecast</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background: #f0f4f8;
  }
  .card {
    background: white;
    border-radius: 12px;
    padding: 40px 60px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }
  h2 {
    margin: 0 0 8px 0;
    font-size: 16px;
    color: #555;
    font-weight: normal;
  }
  #peak {
    font-size: 96px;
    font-weight: bold;
    color: #1a3a5c;
    line-height: 1;
  }
  #label {
    font-size: 14px;
    color: #888;
    margin-top: 12px;
  }
  #station {
    font-size: 12px;
    color: #bbb;
    margin-top: 8px;
  }
</style>
</head>
<body>
<div class="card">
  <div id="peak">...</div>
  <div id="label">ft</div>
  <div id="station"></div>
</div>

<script>
var STATION = "9414750";  // ← Alameda Tide Gauge
var DATUM = "NAVD";       // ← change if needed (MLLW, NAVD, MHHW etc.)

function fmt(d) {
  var y = d.getFullYear();
  var m = String(d.getMonth() + 1);
  var day = String(d.getDate());
  if (m.length < 2) m = '0' + m;
  if (day.length < 2) day = '0' + day;
  return y + m + day;
}

var today = new Date();
var end = new Date();
end.setDate(today.getDate() + 6);

var url = 'https://api.tidesandcurrents.noaa.gov/api/prod/datagetter'
  + '?product=predictions'
  + '&station=' + STATION
  + '&begin_date=' + fmt(today)
  + '&end_date=' + fmt(end)
  + '&datum=' + DATUM
  + '&time_zone=lst_ldt'
  + '&interval=hilo'
  + '&units=english'
  + '&format=json';

var xhr = new XMLHttpRequest();
xhr.open('GET', url, true);
xhr.onload = function() {
  try {
    var json = JSON.parse(xhr.responseText);
    if (json.error) {
      document.getElementById('peak').textContent = 'ERR';
      document.getElementById('station').textContent = json.error.message;
      return;
    }

    var peakVal = -Infinity;
    var peakDate = '';
    var preds = json.predictions;
    for (var i = 0; i < preds.length; i++) {
      var p = preds[i];
      if (p.type !== 'H') continue;
      var val = parseFloat(p.v);
      if (val > peakVal) {
        peakVal = val;
        peakDate = p.t;
      }
    }

    document.getElementById('peak').textContent = peakVal.toFixed(2);
    document.getElementById('label').textContent = 'ft · occurs ' + peakDate;
    document.getElementById('station').textContent = 'NOAA Station ' + STATION + ' · Datum: ' + DATUM;

  } catch(e) {
    document.getElementById('peak').textContent = 'ERR';
    document.getElementById('station').textContent = e.message;
  }
};
xhr.onerror = function() {
  document.getElementById('peak').textContent = 'ERR';
  document.getElementById('station').textContent = 'Network error - check connection';
};
xhr.timeout = 10000;
xhr.ontimeout = function() {
  document.getElementById('peak').textContent = 'ERR';
  document.getElementById('station').textContent = 'Request timed out';
};
xhr.send();
</script>
</body>
</html>
